<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Timer - CallWindow.info</title>
    <meta name="description" content="Track call session time, individual calls, and distractions">
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Call Timer&quot;,&quot;short_name&quot;:&quot;CallTimer&quot;,&quot;start_url&quot;:&quot;/&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#007bff&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%23007bff'/%3E%3Ctext x='96' y='120' text-anchor='middle' font-size='100' fill='white'%3Eâ±%3C/text%3E%3C/svg%3E&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}]}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        padding: 40px;
        max-width: 600px;
        width: 100%;
    }

    h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-weight: 600;
        font-size: 2.5em;
    }

    .timer-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        background: #f8f9fa;
    }

    .timer-section.active {
        border-color: #007bff;
        background: #e3f2fd;
    }

    .timer-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        font-size: 1.2em;
    }

    .timer-display {
        font-family: 'Courier New', monospace;
        font-size: 2.5em;
        font-weight: bold;
        color: #007bff;
        text-align: center;
        margin-bottom: 15px;
        padding: 15px;
        background: white;
        border-radius: 8px;
        border: 2px solid #dee2e6;
    }

    .timer-display.warning {
        background: #fff3cd;
        border-color: #ffeaa7;
        color: #856404;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); }
    }

    .timer-controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 15px;
    }

    button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    button:hover {
        background: #0056b3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,123,255,0.3);
    }

    button:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    button.danger {
        background: #dc3545;
    }

    button.danger:hover {
        background: #c82333;
    }

    button.success {
        background: #28a745;
    }

    button.success:hover {
        background: #218838;
    }

    .call-inputs {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    input[type="text"], textarea {
        padding: 12px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        font-size: 1em;
        font-family: inherit;
    }

    input[type="text"]:focus, textarea:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
    }

    textarea {
        resize: vertical;
        min-height: 80px;
    }

    .call-log {
        margin-top: 30px;
        padding: 20px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        background: #f8f9fa;
    }

    .call-log-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        font-size: 1.2em;
    }

    .call-entry {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        border: 1px solid #dee2e6;
    }

    .call-entry:last-child {
        margin-bottom: 0;
    }

    .call-meta {
        font-weight: 600;
        color: #007bff;
        margin-bottom: 5px;
    }

    .call-details {
        color: #666;
        font-size: 0.9em;
    }

    .summary {
        margin-top: 30px;
        padding: 20px;
        border: 2px solid #28a745;
        border-radius: 10px;
        background: #d4edda;
        text-align: center;
    }

    .summary-title {
        font-weight: 600;
        color: #155724;
        margin-bottom: 15px;
        font-size: 1.2em;
    }

    .summary-stats {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
    }

    .stat {
        text-align: center;
    }

    .stat-value {
        font-family: 'Courier New', monospace;
        font-size: 1.5em;
        font-weight: bold;
        color: #155724;
    }

    .stat-label {
        font-size: 0.9em;
        color: #155724;
        margin-top: 5px;
    }

    .export-controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
    }

    @media (max-width: 600px) {
        .container {
            padding: 20px;
        }
        
        h1 {
            font-size: 2em;
        }
        
        .timer-display {
            font-size: 2em;
        }
        
        .timer-controls {
            flex-direction: column;
        }
        
        .summary-stats {
            flex-direction: column;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>ðŸ“ž Call Timer</h1>

```
    <!-- Session Timer -->
    <div class="timer-section" id="sessionSection">
        <div class="timer-title">Session Timer</div>
        <div class="timer-display" id="sessionDisplay">00:00:00</div>
        <div class="timer-controls">
            <button id="startSessionBtn">Start Session</button>
            <button id="stopSessionBtn" disabled>Stop Session</button>
        </div>
    </div>

    <!-- Individual Call Timer -->
    <div class="timer-section" id="callSection">
        <div class="timer-title">Current Call</div>
        <div class="timer-display" id="callDisplay">00:00:00</div>
        <div class="timer-controls">
            <button id="startCallBtn" disabled>Start Call</button>
            <button id="endCallBtn" disabled>End Call</button>
        </div>
        <div class="call-inputs">
            <input type="text" id="callLabel" placeholder="Call label (optional)" disabled>
            <textarea id="callNotes" placeholder="Call notes (optional)" disabled></textarea>
        </div>
    </div>

    <!-- Distraction Timer -->
    <div class="timer-section" id="distractionSection">
        <div class="timer-title">Distraction Time</div>
        <div class="timer-display" id="distractionDisplay">00:00:00</div>
        <div class="timer-controls">
            <button id="startDistractionBtn" disabled>Start Break</button>
            <button id="endDistractionBtn" disabled>End Break</button>
        </div>
    </div>

    <!-- Call Log -->
    <div class="call-log" id="callLog" style="display: none;">
        <div class="call-log-title">Call Log</div>
        <div id="callEntries"></div>
    </div>

    <!-- Session Summary -->
    <div class="summary" id="sessionSummary" style="display: none;">
        <div class="summary-title">Session Summary</div>
        <div class="summary-stats">
            <div class="stat">
                <div class="stat-value" id="totalSessionTime">00:00:00</div>
                <div class="stat-label">Total Session</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalCallTime">00:00:00</div>
                <div class="stat-label">Total Calls</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalDistractionTime">00:00:00</div>
                <div class="stat-label">Total Distractions</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="productivePercentage">0%</div>
                <div class="stat-label">Productive Time</div>
            </div>
        </div>
        <div class="export-controls">
            <button id="exportCsvBtn" class="success">Export CSV</button>
            <button id="clearSessionBtn" class="danger">Clear Session</button>
        </div>
    </div>
</div>

<script>
    class CallTimer {
        constructor() {
            this.sessionStartTime = null;
            this.sessionEndTime = null;
            this.sessionElapsed = 0;
            
            this.callStartTime = null;
            this.callElapsed = 0;
            
            this.distractionStartTime = null;
            this.distractionElapsed = 0;
            
            this.calls = [];
            this.isSessionActive = false;
            this.isCallActive = false;
            this.isDistractionActive = false;
            
            this.intervalId = null;
            
            this.initializeElements();
            this.bindEvents();
            this.loadFromStorage();
            this.startUpdateLoop();
        }
        
        initializeElements() {
            this.elements = {
                sessionSection: document.getElementById('sessionSection'),
                sessionDisplay: document.getElementById('sessionDisplay'),
                startSessionBtn: document.getElementById('startSessionBtn'),
                stopSessionBtn: document.getElementById('stopSessionBtn'),
                
                callSection: document.getElementById('callSection'),
                callDisplay: document.getElementById('callDisplay'),
                startCallBtn: document.getElementById('startCallBtn'),
                endCallBtn: document.getElementById('endCallBtn'),
                callLabel: document.getElementById('callLabel'),
                callNotes: document.getElementById('callNotes'),
                
                distractionSection: document.getElementById('distractionSection'),
                distractionDisplay: document.getElementById('distractionDisplay'),
                startDistractionBtn: document.getElementById('startDistractionBtn'),
                endDistractionBtn: document.getElementById('endDistractionBtn'),
                
                callLog: document.getElementById('callLog'),
                callEntries: document.getElementById('callEntries'),
                
                sessionSummary: document.getElementById('sessionSummary'),
                totalSessionTime: document.getElementById('totalSessionTime'),
                totalCallTime: document.getElementById('totalCallTime'),
                totalDistractionTime: document.getElementById('totalDistractionTime'),
                productivePercentage: document.getElementById('productivePercentage'),
                
                exportCsvBtn: document.getElementById('exportCsvBtn'),
                clearSessionBtn: document.getElementById('clearSessionBtn')
            };
        }
        
        bindEvents() {
            this.elements.startSessionBtn.addEventListener('click', () => this.startSession());
            this.elements.stopSessionBtn.addEventListener('click', () => this.stopSession());
            
            this.elements.startCallBtn.addEventListener('click', () => this.startCall());
            this.elements.endCallBtn.addEventListener('click', () => this.endCall());
            
            this.elements.startDistractionBtn.addEventListener('click', () => this.startDistraction());
            this.elements.endDistractionBtn.addEventListener('click', () => this.endDistraction());
            
            this.elements.exportCsvBtn.addEventListener('click', () => this.exportCsv());
            this.elements.clearSessionBtn.addEventListener('click', () => this.clearSession());
            
            // Auto-save on input
            this.elements.callLabel.addEventListener('input', () => this.saveToStorage());
            this.elements.callNotes.addEventListener('input', () => this.saveToStorage());
        }
        
        startSession() {
            this.sessionStartTime = Date.now();
            this.isSessionActive = true;
            this.sessionElapsed = 0;
            
            this.elements.startSessionBtn.disabled = true;
            this.elements.stopSessionBtn.disabled = false;
            this.elements.startCallBtn.disabled = false;
            this.elements.startDistractionBtn.disabled = false;
            this.elements.callLabel.disabled = false;
            this.elements.callNotes.disabled = false;
            
            this.elements.sessionSection.classList.add('active');
            this.elements.callLog.style.display = 'block';
            
            this.saveToStorage();
        }
        
        stopSession() {
            this.sessionEndTime = Date.now();
            this.isSessionActive = false;
            
            // Stop any active timers
            if (this.isCallActive) this.endCall();
            if (this.isDistractionActive) this.endDistraction();
            
            this.elements.startSessionBtn.disabled = false;
            this.elements.stopSessionBtn.disabled = true;
            this.elements.startCallBtn.disabled = true;
            this.elements.endCallBtn.disabled = true;
            this.elements.startDistractionBtn.disabled = true;
            this.elements.endDistractionBtn.disabled = true;
            this.elements.callLabel.disabled = true;
            this.elements.callNotes.disabled = true;
            
            this.elements.sessionSection.classList.remove('active');
            this.elements.callSection.classList.remove('active');
            this.elements.distractionSection.classList.remove('active');
            
            this.showSummary();
            this.saveToStorage();
        }
        
        startCall() {
            this.callStartTime = Date.now();
            this.isCallActive = true;
            this.callElapsed = 0;
            
            this.elements.startCallBtn.disabled = true;
            this.elements.endCallBtn.disabled = false;
            this.elements.callSection.classList.add('active');
            
            this.saveToStorage();
        }
        
        endCall() {
            if (!this.isCallActive) return;
            
            const callEndTime = Date.now();
            const callDuration = callEndTime - this.callStartTime;
            
            const call = {
                startTime: new Date(this.callStartTime),
                endTime: new Date(callEndTime),
                duration: callDuration,
                label: this.elements.callLabel.value.trim(),
                notes: this.elements.callNotes.value.trim()
            };
            
            this.calls.push(call);
            this.isCallActive = false;
            this.callElapsed = 0;
            
            this.elements.startCallBtn.disabled = false;
            this.elements.endCallBtn.disabled = true;
            this.elements.callSection.classList.remove('active');
            this.elements.callDisplay.classList.remove('warning');
            
            // Clear inputs
            this.elements.callLabel.value = '';
            this.elements.callNotes.value = '';
            
            this.updateCallLog();
            this.saveToStorage();
        }
        
        startDistraction() {
            this.distractionStartTime = Date.now();
            this.isDistractionActive = true;
            
            this.elements.startDistractionBtn.disabled = true;
            this.elements.endDistractionBtn.disabled = false;
            this.elements.distractionSection.classList.add('active');
            
            this.saveToStorage();
        }
        
        endDistraction() {
            if (!this.isDistractionActive) return;
            
            const distractionEndTime = Date.now();
            const distractionDuration = distractionEndTime - this.distractionStartTime;
            this.distractionElapsed += distractionDuration;
            
            this.isDistractionActive = false;
            
            this.elements.startDistractionBtn.disabled = false;
            this.elements.endDistractionBtn.disabled = true;
            this.elements.distractionSection.classList.remove('active');
            
            this.saveToStorage();
        }
        
        startUpdateLoop() {
            this.intervalId = setInterval(() => {
                this.updateDisplays();
            }, 1000);
        }
        
        updateDisplays() {
            const now = Date.now();
            
            // Update session timer
            if (this.isSessionActive) {
                const sessionTime = now - this.sessionStartTime;
                this.elements.sessionDisplay.textContent = this.formatTime(sessionTime);
            }
            
            // Update call timer
            if (this.isCallActive) {
                const callTime = now - this.callStartTime;
                this.elements.callDisplay.textContent = this.formatTime(callTime);
                
                // Show warning after 5 minutes
                if (callTime >= 5 * 60 * 1000) {
                    this.elements.callDisplay.classList.add('warning');
                }
            } else {
                this.elements.callDisplay.textContent = this.formatTime(this.callElapsed);
            }
            
            // Update distraction timer
            if (this.isDistractionActive) {
                const currentDistraction = now - this.distractionStartTime;
                const totalDistraction = this.distractionElapsed + currentDistraction;
                this.elements.distractionDisplay.textContent = this.formatTime(totalDistraction);
            } else {
                this.elements.distractionDisplay.textContent = this.formatTime(this.distractionElapsed);
            }
        }
        
        formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        updateCallLog() {
            this.elements.callEntries.innerHTML = '';
            
            this.calls.forEach((call, index) => {
                const entry = document.createElement('div');
                entry.className = 'call-entry';
                
                const meta = document.createElement('div');
                meta.className = 'call-meta';
                meta.textContent = `Call ${index + 1}: ${this.formatTime(call.duration)} - ${call.startTime.toLocaleTimeString()}`;
                
                const details = document.createElement('div');
                details.className = 'call-details';
                const label = call.label ? `"${call.label}"` : 'No label';
                const notes = call.notes ? ` - ${call.notes}` : '';
                details.textContent = `${label}${notes}`;
                
                entry.appendChild(meta);
                entry.appendChild(details);
                this.elements.callEntries.appendChild(entry);
            });
        }
        
        showSummary() {
            const totalSessionTime = this.sessionEndTime - this.sessionStartTime;
            const totalCallTime = this.calls.reduce((sum, call) => sum + call.duration, 0);
            const totalDistractionTime = this.distractionElapsed;
            const productiveTime = totalCallTime;
            const productivePercentage = totalSessionTime > 0 ? Math.round((productiveTime / totalSessionTime) * 100) : 0;
            
            this.elements.totalSessionTime.textContent = this.formatTime(totalSessionTime);
            this.elements.totalCallTime.textContent = this.formatTime(totalCallTime);
            this.elements.totalDistractionTime.textContent = this.formatTime(totalDistractionTime);
            this.elements.productivePercentage.textContent = `${productivePercentage}%`;
            
            this.elements.sessionSummary.style.display = 'block';
        }
        
        exportCsv() {
            if (this.calls.length === 0) {
                alert('No calls to export!');
                return;
            }
            
            const headers = ['Session Date', 'Call Number', 'Start Time', 'End Time', 'Duration (minutes)', 'Label', 'Notes'];
            const sessionDate = new Date(this.sessionStartTime).toLocaleDateString();
            
            const rows = this.calls.map((call, index) => [
                sessionDate,
                index + 1,
                call.startTime.toLocaleTimeString(),
                call.endTime.toLocaleTimeString(),
                Math.round(call.duration / 60000 * 100) / 100, // Convert to minutes with 2 decimal places
                call.label || '',
                call.notes || ''
            ]);
            
            // Add summary row
            const totalSessionTime = this.sessionEndTime - this.sessionStartTime;
            const totalCallTime = this.calls.reduce((sum, call) => sum + call.duration, 0);
            const totalDistractionTime = this.distractionElapsed;
            const productivePercentage = totalSessionTime > 0 ? Math.round((totalCallTime / totalSessionTime) * 100) : 0;
            
            rows.push([]);
            rows.push(['SUMMARY', '', '', '', '', '', '']);
            rows.push(['Total Session Time', '', '', '', Math.round(totalSessionTime / 60000 * 100) / 100, '', '']);
            rows.push(['Total Call Time', '', '', '', Math.round(totalCallTime / 60000 * 100) / 100, '', '']);
            rows.push(['Total Distraction Time', '', '', '', Math.round(totalDistractionTime / 60000 * 100) / 100, '', '']);
            rows.push(['Productive Percentage', '', '', '', `${productivePercentage}%`, '', '']);
            
            const csvContent = [headers, ...rows]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `call-session-${sessionDate.replace(/\//g, '-')}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        clearSession() {
            if (confirm('Are you sure you want to clear this session? This cannot be undone.')) {
                this.sessionStartTime = null;
                this.sessionEndTime = null;
                this.sessionElapsed = 0;
                this.callStartTime = null;
                this.callElapsed = 0;
                this.distractionStartTime = null;
                this.distractionElapsed = 0;
                this.calls = [];
                this.isSessionActive = false;
                this.isCallActive = false;
                this.isDistractionActive = false;
                
                this.elements.sessionDisplay.textContent = '00:00:00';
                this.elements.callDisplay.textContent = '00:00:00';
                this.elements.distractionDisplay.textContent = '00:00:00';
                this.elements.callLabel.value = '';
                this.elements.callNotes.value = '';
                
                this.elements.startSessionBtn.disabled = false;
                this.elements.stopSessionBtn.disabled = true;
                this.elements.startCallBtn.disabled = true;
                this.elements.endCallBtn.disabled = true;
                this.elements.startDistractionBtn.disabled = true;
                this.elements.endDistractionBtn.disabled = true;
                this.elements.callLabel.disabled = true;
                this.elements.callNotes.disabled = true;
                
                this.elements.sessionSection.classList.remove('active');
                this.elements.callSection.classList.remove('active');
                this.elements.distractionSection.classList.remove('active');
                this.elements.callDisplay.classList.remove('warning');
                
                this.elements.callLog.style.display = 'none';
                this.elements.sessionSummary.style.display = 'none';
                
                this.clearStorage();
            }
        }
        
        saveToStorage() {
            const data = {
                sessionStartTime: this.sessionStartTime,
                sessionEndTime: this.sessionEndTime,
                sessionElapsed: this.sessionElapsed,
                callStartTime: this.callStartTime,
                callElapsed: this.callElapsed,
                distractionStartTime: this.distractionStartTime,
                distractionElapsed: this.distractionElapsed,
                calls: this.calls,
                isSessionActive: this.isSessionActive,
                isCallActive: this.isCallActive,
                isDistractionActive: this.isDistractionActive,
                callLabel: this.elements.callLabel.value,
                callNotes: this.elements.callNotes.value
            };
            
            localStorage.setItem('callTimerData', JSON.stringify(data));
        }
        
        loadFromStorage() {
            const stored = localStorage.getItem('callTimerData');
            if (!stored) return;
            
            try {
                const data = JSON.parse(stored);
                
                this.sessionStartTime = data.sessionStartTime;
                this.sessionEndTime = data.sessionEndTime;
                this.sessionElapsed = data.sessionElapsed || 0;
                this.callStartTime = data.callStartTime;
                this.callElapsed = data.callElapsed || 0;
                this.distractionStartTime = data.distractionStartTime;
                this.distractionElapsed = data.distractionElapsed || 0;
                this.calls = data.calls || [];
                this.isSessionActive = data.isSessionActive || false;
                this.isCallActive = data.isCallActive || false;
                this.isDistractionActive = data.isDistractionActive || false;
                
                // Restore UI state
                if (this.isSessionActive) {
                    this.elements.startSessionBtn.disabled = true;
                    this.elements.stopSessionBtn.disabled = false;
                    this.elements.startCallBtn.disabled = false;
                    this.elements.startDistractionBtn.disabled = false;
                    this.elements.callLabel.disabled = false;
                    this.elements.callNotes.disabled = false;
                    this.elements.sessionSection.classList.add('active');
                    this.elements.callLog.style.display = 'block';
                }
                
                if (this.isCallActive) {
                    this.elements.startCallBtn.disabled = true;
                    this.elements.endCallBtn.disabled = false;
                    this.elements.callSection.classList.add('active');
                }
                
                if (this.isDistractionActive) {
                    this.elements.startDistractionBtn.disabled = true;
                    this.elements.endDistractionBtn.disabled = false;
                    this.elements.distractionSection.classList.add('active');
                }
                
                if (data.callLabel) this.elements.callLabel.value = data.callLabel;
                if (data.callNotes) this.elements.callNotes.value = data.callNotes;
                
                // Convert stored dates back to Date objects
                this.calls = this.calls.map(call => ({
                    ...call,
                    startTime: new Date(call.startTime),
                    endTime: new Date(call.endTime)
                }));
                
                this.updateCallLog();
                
                if (this.sessionEndTime) {
                    this.showSummary();
                }
                
            } catch (e) {
                console.error('Error loading saved data:', e);
            }
        }
        
        clearStorage
```